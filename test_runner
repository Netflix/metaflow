#!/bin/bash

set -o errexit -o nounset -o pipefail

install_deps() {
  for version in 2 3;
  do
    python$version -m pip install . coverage flake8
  done
}

lint_python() {
  flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics \
           --builtins=assert_equals,assert_exception,inputs,is_resumed,NUM_FOREACH,NUM_LINES,ResumeFromHere,TestRetry
}

run_tests() {
  cd test/core && PYTHONPATH=`pwd`/../../ python3 run_tests.py --num-parallel 8
}

install_deps && lint_python && run_tests
